/*! Leverage.js - v0.0.1 - 2012-08-31
* Copyright (c) 2012 Phil Burrows; Licensed MIT */
(function(){var e={};e.noop=function(){},e.bind=function(e,t){return function(){return e.apply(t,arguments)}},e.bindLeverageFunctions=function(t){for(fn in t)/^_leverage/.test(fn)&&[fn].apply&&(console.log("binding: "+fn),l[fn]=e.bind(l[fn],t))},this.Leverage=e}).call(this),function(){Function.prototype.include=function(){for(var e=0;e<arguments.length;e++)arguments[e].instanceMethods?_.extend(this.prototype,arguments[e].instanceMethods):_.extend(this.prototype,arguments[e]),arguments[e].classMethods&&_.extend(this,arguments[e].classMethods);return this},Function.prototype.extend=function(){for(var e=0;e<arguments.length;e++)arguments[e].classMethods?_.extend(this,arguments[e].classMethods):_.extend(this,arguments[e]),arguments[e].instanceMethods&&_.extend(this.prototype,arguments[e].instanceMethods);return this},Function.prototype.boundTo=function(){var e=this,t=function(){return e.apply(this,arguments)};return t.__boundProperties=Array.prototype.slice.call(arguments,0),t}}.call(this),function(){var e=function(e){this.errors=e||[]};e.prototype.blank=function(){return this.errors.length===0},e.prototype.add=function(e,t){this.errors.push({attribute:e,message:t})};var t={instanceMethods:{getErrors:function(){return this._leverageErrors=this._leverageErrors||new e,this._leverageErrors},isValid:function(){return this.validate(),this.getErrors().blank()},validate:function(){this._leverageErrors=new e,this._leverageValidations;var t=this._leverageValidations;for(n in t)for(var r=t[n].length-1;r>=0;r--)t[n][r].call(this)},_leverageAddError:function(e,t){this.getErrors().add(e,t)}},classMethods:{validatesPresenceOf:function(e,t){t=t||"cannot be blank",n.call(this,e,t,function(){return typeof this[e]=="undefined"||this[e]===""})},validatesLengthOf:function(e,t,r){r=r||"must be at least "+t+" characters in length",n.call(this,e,r,function(){return!this[e]||this[e].length<t})},__clearValidations:function(){this.prototype._leverageValidations={}}}},n=function(e,t,n){this.prototype._leverageValidations=this.prototype._leverageValidations||{},this.prototype._leverageValidations[e]=this.prototype._leverageValidations[e]||[],this.prototype._leverageValidations[e].push(function(){n.call(this)&&this._leverageAddError(e,t)})};this.Leverage.Validations=t}.call(this),function(){var e={classMethods:{before:function(e,t){var n=this.prototype[e];this.prototype[e]=function(){return t.apply(this,arguments),n.apply(this,arguments)}},after:function(e,t){var n=this.prototype[e];this.prototype[e]=function(){var e=n.apply(this,arguments);return t.apply(this,arguments),e}}}};this.Leverage.Callbacks=e}.call(this),function(){var e={instanceMethods:{_bindings:{},bind:function(e,t){return this._bindings[e]=this._bindings[e]||[],this._bindings[e].push(t),this},initialize:function(){var e=this;for(prop in this)if(typeof this[prop]!="undefined"&&this[prop].__boundProperties)for(var t=this[prop].__boundProperties.length-1;t>=0;t--)this.bind("change:"+this[prop].__boundProperties[t],function(t,n){e.trigger("change:"+prop)})},isBound:function(e,t){for(var n=this._bindings.length-1;n>=0;n--)if(this._bindings[n]===t)return!0;return!1},trigger:function(e,t){var n=this._bindings[e];if(typeof n!="undefined"){var r=n.length;for(var i=0;i<r;i++)n[i].call(this,t)}return this}}};e.fire=e.trigger,this.Leverage.Events=e}.call(this),function(){var e=function(){typeof this.__initialize!="undefined"&&this.__initialize.apply(this,arguments),this.initialize.apply(this,arguments)};e.prototype.initialize=function(e){if(typeof e=="object")for(key in e)this[key]=e[key]},e.extend=function(e,t){var n,r=this;n=function(){r.apply(this,arguments)},_.extend(n,r);var i=function(){this.constructor=n};return i.prototype=r.prototype,n.prototype=new i,e&&_.extend(n.prototype,e),t&&_.extend(n,t),n.__super=r.prototype,n},this.Leverage.Class=e}.call(this),function(){var e=Leverage.Class.extend({initialize:function(){var e=this;this.events=this.events||{};if(this.el)for(key in this.events){var t=key.split(/\s+/),n=this[this.events[key]];this.el.delegate(t[0],t[1],function(t){n.call(e,t,this)})}}});this.Leverage.Controller=e}.call(this),function(){var e=function(){var e=function(){return((1+Math.random())*65536|0).toString(16).substring(1)};return e()+e()+e()+e()+e()+e()+e()+e()},t=function(e){for(prop in e)if(e[prop].__boundProperties)for(var t=e[prop].__boundProperties.length-1;t>=0;t--){var n="change:"+e[prop].__boundProperties[t],r="change:"+prop;e.bind(n,function(){e.trigger(r)})}},n=Leverage.Class.extend({__initialize:function(){Leverage.bindLeverageFunctions(this),t(this),this.id=this.id||e()},set:function(e,t,n){n==null&&(n=!0),this[e]=t,n&&this.trigger("change:"+e,t)}});n.include(Leverage.Events),n.include(Leverage.Validations),n.include(Leverage.Callbacks),this.Leverage.Model=n}.call(this),function(){var e=/.^/,t={"\\":"\\","'":"'",r:"\r",n:"\n",t:"	",u2028:"\u2028",u2029:"\u2029"};for(var n in t)t[t[n]]=n;var r=/\\|'|\r|\n|\t|\u2028|\u2029/g,i=/\\(\\|'|r|n|t|u2028|u2029)/g,s=function(e){return e.replace(i,function(e,n){return t[n]})},o=function(n,i,u){u=_.defaults(u||{},o.settings);var a="__p+='"+n.replace(r,function(e){return"\\"+t[e]}).replace(u.bind||e,function(e,t){var t=s(t).replace(/^\s+|\s+$/g,""),n=t.split("."),r=n[n.length-1],i;n.length===1?i=u.variable||"obj":n.length>2?i=n.slice(0,n.length-2).join("."):i=n[0];var o=!1,a=/\(\)\s*$/;a.test(r)&&(o=!0,r=r.replace(a,""));var f="'+\n__bind("+i+", '"+r+"',"+o+")+\n";return f+="'<span class=\"' + __className("+i+",'"+r+"') + '\">'+("+s(t)+")+'</span>'+\n'",f}).replace(u.escape||e,function(e,t){return"'+\n_.escape("+s(t)+")+\n'"}).replace(u.interpolate||e,function(e,t){return"'+\n("+s(t)+")+\n'"}).replace(u.evaluate||e,function(e,t){return"';\n"+s(t)+"\n;__p+='"})+"';\n";u.variable||(a="with(obj||{}){\n"+a+"}\n"),a="var __p='';var print=function(){__p+=Array.prototype.join.call(arguments, '')};\nvar __className=function(binder, attr){ return 'data-bind-'+binder.id+'-'+attr.replace(/()s*$/, ''); };var __bind=function(binder, attr, isFunc){ var c=__className(binder,attr); if(!Leverage.Template.allBindings[c]){ binder.bind('change:'+attr, function(newVal){var h = $('.'+c); if(isFunc){ h.text(binder[attr]()); }else{ h.text(newVal); } }); Leverage.Template.allBindings[c]=true; } return''; };\n"+a+"return __p;\n";var f=new Function(u.variable||"obj","_",a);if(i)return f(i,_);var l=function(e){return f.call(this,e,_)};return l.source="function("+(u.variable||"obj")+"){\n"+a+"}",l};o.settings={interpolate:/\{=(.+?)=\}/g,escape:/\{==(.+?)==\}/g,evaluate:/\{%(.+?)%\}/g,bind:/\{=>(.+?)<=\}/g},o.allBindings={},this.Leverage.Template=o}.call(this);