/*! Leverage.js - v0.0.2 - 2012-11-18
* Copyright (c) 2012 Phil Burrows; Licensed MIT */
(function(){var e={};e.noop=function(){},e.bind=function(e,t){return function(){return e.apply(t,arguments)}},e.bindLeverageFunctions=function(t){for(var n in t)/^_leverage/.test(n)&&[n].apply&&(console.log("binding: "+n),t[n]=e.bindContext(t[n],t))},this.Leverage=e}).call(this),function(){var e=function(e,t,n){var r=e.prototype.initialize,i=t.initialize;return i||(i=t.instanceMethods?t.instanceMethods.initialize:null),i||(i=t.classMethods?t.classMethods.initialize:null),function(){i&&(i.apply(e,n),console.log("called child init")),r&&(r.apply(e,n),console.log("called parent init",r))}};Function.prototype.include=function(){for(var e=0;e<arguments.length;e++){var t=this.prototype.initialize,n=arguments[e].initialize;n||(n=arguments[e].instanceMethods?arguments[e].instanceMethods.initialize:null),n||(n=arguments[e].classMethods?arguments[e].classMethods.initialize:null);var r;n&&(r=function(){n&&n.apply(this,arguments),t&&t.apply(this,arguments)}),arguments[e].instanceMethods?_.extend(this.prototype,arguments[e].instanceMethods):_.extend(this.prototype,arguments[e]),arguments[e].classMethods&&_.extend(this,arguments[e].classMethods),this.prototype.initialize=r||this.prototype.initialize}return this},Function.prototype.boundTo=function(){var e=this,t=function(){return e.apply(this,arguments)};return t.__boundProperties=Array.prototype.slice.call(arguments,0),t}}.call(this),function(){var e=function(e){this.errors=e||[]};e.prototype.blank=function(){return this.errors.length===0},e.prototype.add=function(e,t){this.errors.push({attribute:e,message:t})};var t={instanceMethods:{getErrors:function(){return this._leverageErrors=this._leverageErrors||new e,this._leverageErrors},isValid:function(){return this.validate(),this.getErrors().blank()},validate:function(){this._leverageErrors=new e,this._leverageValidations=this._leverageValidations||{};var t=this._leverageValidations;for(var n in t)for(var r=t[n].length-1;r>=0;r--)t[n][r].call(this)},_leverageAddError:function(e,t){this.getErrors().add(e,t)}},classMethods:{validatesPresenceOf:function(e,t){t=t||"cannot be blank",n.call(this,e,t,function(){return typeof this[e]=="undefined"||this[e]===""})},validatesLengthOf:function(e,t,r){r=r||"must be at least "+t+" characters in length",n.call(this,e,r,function(){return!this[e]||this[e].length<t})},__clearValidations:function(){this.prototype._leverageValidations={}}}},n=function(e,t,n){this.prototype._leverageValidations=this.prototype._leverageValidations||{},this.prototype._leverageValidations[e]=this.prototype._leverageValidations[e]||[],this.prototype._leverageValidations[e].push(function(){n.call(this)&&this._leverageAddError(e,t)})};this.Leverage.Validations=t}.call(this),function(){var e={classMethods:{before:function(e,t){var n=this.prototype[e];this.prototype[e]=_.extend(function(){return t.apply(this,arguments),n.apply(this,arguments)},n)},after:function(e,t){var n=this.prototype[e];this.prototype[e]=_.extend(function(){var e=n.apply(this,arguments);return t.apply(this,arguments),e},n)}}};this.Leverage.Callbacks=e}.call(this),function(){var e={instanceMethods:{_bindings:{},bind:function(e,t){return this._bindings[e]=this._bindings[e]||[],this._bindings[e].push(t),this},initialize:function(){var e=this;for(var t in this)if(typeof this[t]!="undefined"&&this[t].__boundProperties)for(var n=this[t].__boundProperties.length-1;n>=0;n--)(function(t,n){this.bind("change:"+this[t].__boundProperties[n],function(n,r){e.trigger("change:"+t)})}).call(this,t,n)},isBound:function(e,t){for(var n=this._bindings.length-1;n>=0;n--)if(this._bindings[n]===t)return!0;return!1},trigger:function(e,t){var n=this._bindings[e];if(typeof n!="undefined"){var r=n.length;for(var i=0;i<r;i++)n[i].call(this,t)}return this}}};e.fire=e.trigger,e.on=e.bind,this.Leverage.Events=e}.call(this),function(){var e=function(){typeof this.__initialize!="undefined"&&this.__initialize.apply(this,arguments),this.initialize.apply(this,arguments)};e.prototype.initialize=function(e){if(typeof e=="object")for(var t in e)this[t]=e[t]},e.extend=function(e,t){var n,r=this;n=function(){r.apply(this,arguments)},_.extend(n,r);var i=function(){this.constructor=n};i.prototype=r.prototype,n.prototype=new i,e&&_.extend(n.prototype,e),t&&_.extend(n,t);var s=this.prototype.initialize,o;e&&(o=e.initialize),!o&&t&&(o=t.initialize);var u;return o&&(u=function(){o&&o.apply(this,arguments),s&&s.apply(this,arguments)}),n.prototype.initialize=u||r.prototype.initialize,n.__super=r.prototype,n},this.Leverage.Class=e}.call(this),function(){var e=Leverage.Class.extend({initialize:function(){var e=this;this.events=this.events||{},this.__handlers={};if(this.el){typeof this.el=="string"&&(this.el=$(this.el));var t=this.events.length;for(var n in this.events){var r=n.split(/\s+/),i=[];if(typeof this.events[n]!="string")for(var s=this.events[n].length-1;s>=0;s--)i.push(this[this.events[n][s]]);else i.push(this[this.events[n]]);this.__handlers[n]=this.__handlers[n]||[];for(var s=i.length-1;s>=0;s--)this.__handlers[n].push(i[s]);this.el.delegate(r[0],r[1],function(t){var n=i.length;for(var r=0;r<n;r++)i[r].call(e,t,this)})}}},html:function(e){if(this.el)return this.el.html(e)}});this.Leverage.Controller=e}.call(this),function(){var e=function(){var e=function(){return((1+Math.random())*65536|0).toString(16).substring(1)};return e()+e()+e()+e()+e()+e()+e()+e()},t=Leverage.Class.extend({__initialize:function(){Leverage.bindLeverageFunctions(this),this.id=this.id||e()},set:function(e,t,n){return n==null&&(n=!0),this[e]=t,n&&this.trigger("change:"+e,t),this},get:function(e){return this[e]}});t.include(Leverage.Events),t.include(Leverage.Validations),t.include(Leverage.Callbacks),this.Leverage.Model=t}.call(this),function(){var e,t=((e=window.history)!=null?e.pushState:void 0)!=null,n=function(e){var t=document.createElement("a");t.href=e,this.queryString=t.search.replace(/^\?/,""),this.hash=t.hash.replace(/^#/,""),this.path=t.pathname,this.fullPathWithoutHash=this.path+(this.queryString.length>0?"?"+this.queryString:""),this.fullPath=this.fullPathWithoutHash+(this.hash.length>0?"#"+this.hash:""),this.queryParams={};var n,r=/\+/g,i=/([^&=]+)=?([^&]*)/g,s=function(e){return decodeURIComponent(e.replace(r," "))},o=this.queryString;while(n=i.exec(o))this.queryParams[s(n[1])]=s(n[2])},r=function(e,t,r,i){var s=new n(e),o=this;this.url=s,this.path=s.path,this.queryString=s.queryString,this.queryParams=s.queryParams,this.fullPath=s.fullPath,this.method=t||"GET",this.body=r;var u=this.path.split("/");this.pathPieces=u[0]===""?u.slice(1):u;var a=i.findRoute(this.path);this.pathParams=a?i.pathParams(this.path,a):{},this.params=$.extend({},this.pathParams,this.queryParams),this.perform=function(){a&&(i.trigger("request:before"),a.handler(this),i.trigger("request"))}},i=function(e){e==null&&(e={}),this.options=$.extend({},{pushState:!0,test:!1},e),this.usePushState=this.options.pushState&&t;var i=this,s=i,o=[],u,a,f,l,c;this.updateUrl=function(e){var t=new n(e);return this.usePushState?history.pushState({},document.title,t.fullPath):window.location.hash=t.fullPathWithoutHash},this.createRequest=function(e,t,n){var i=new r(e,t,n,this);i.perform()},this.goTo=function(e){this.options.test?this.handleUrlChange(e):this.updateUrl(e)},this.navigate=this.goTo,this.handleUrlChange=function(e){if(this.usePushState)e==null&&(e=document.location),this.createRequest((new n(e)).fullPath);else{var t=new n(e||document.location),r=e==null?t.hash:t.fullPathWithoutHash;this.createRequest(r)}},this.pushDefaultRoute=function(){a&&this.goTo(a)},this.setDefault=function(e){a=e},this.addRoute=function(e){o.push(e)},this.routes=function(){return o},this.findRoute=function(e){var t;for(var n=0;n<o.length;n++)if(o[n].matcher.test(e))return o[n];return!1},this.pathParams=function(e,t){var n={},r=e.match(t.matcher);for(var i=t.params.length-1;i>=0;i--)n[t.params[i]]=r[i+1];return n},this.options.test||(this.usePushState?$(window).bind("popstate",function(){i.handleUrlChange()}):$(window).bind("hashchange",function(){i.handleUrlChange()})),$(document).ready(function(){var e=new n(document.location);i.usePushState?e.path&&e.path!=="/"?$(window).trigger("popstate"):i.pushDefaultRoute():e.hash&&e.hash!=="/"?$(window).trigger("hashchange"):i.pushDefaultRoute()})};i.prototype.catchAll=function(e){return this.addRoute({matcher:/.*/,params:[],handler:e}),this},i.prototype.define=function(e,t){var n=/:([^:]+)/,r=e.split("/"),i=[];e=e.replace(/^\/+/,"");for(var s=0;s<r.length;s++){var o;if(o=r[s].match(n))r[s]="([^\\/]+)",i.push(o[1])}var u=new RegExp("^"+r.join("\\/")+"/?$");return this.addRoute({matcher:u,params:i,handler:t}),this},i.prototype.resources=function(e,t,n){n==null&&(n={});var r=this;if(/\//.test(e)){var i=e.split("/");for(var s=0;s<i.length;s++)s+1!==i.length&&(i[s]=i[s]+"/:"+i[s].slice(0,-1)+"_id");e=i.join("/")}e="/"+e;for(var o in t)o==="show"?r.define(e+"/:id",t[o]):o==="index"?r.define(e,t[o]):o==="edit"?r.define(e+"/:id/edit",t[o]):o==="update"?r.define(e+"/:id/update",t[o]):o==="delete"&&r.define(e+"/:id/delete",t[o]);return this},i.include(Leverage.Events),this.Leverage.Router=i}.call(this),function(){var e=/.^/,t={"\\":"\\","'":"'",r:"\r",n:"\n",t:"	",u2028:"\u2028",u2029:"\u2029"};for(var n in t)t[t[n]]=n;var r=/\\|'|\r|\n|\t|\u2028|\u2029/g,i=/\\(\\|'|r|n|t|u2028|u2029)/g,s=function(e){return e.replace(i,function(e,n){return t[n]})},o=function(e,t){e=s(e).replace(/^\s+|\s+$/g,"");var n=e.split("."),r=n[n.length-1],i;n.length===1?i=t.variable||"obj":n.length>2?i=n.slice(0,n.length-2).join("."):i=n[0];var o=!1,u=/\(\)\s*$/;return u.test(r)&&(o=!0,r=r.replace(u,"")),{obj:i,val:r,isFunc:o,code:e}},u=function(n,i,a){a=_.defaults(a||{},u.settings);var f="__p+='"+n.replace(r,function(e){return"\\"+t[e]}).replace(a.bind||e,function(e,t){var n=o(t,a),r="'+\n__bind("+n.obj+", '"+n.val+"',"+n.isFunc+")+\n";return r+="'<span class=\"' + __className("+n.obj+",'"+n.val+"') + '\">'+("+s(n.code)+")+'</span>'+\n'",r}).replace(a.modelBind||e,function(e,t){var n=o(t,a),r="'+\n__boundModel("+n.obj+")+\n'";return r+="'+\n("+s(t)+")+'\" onchange=\"Leverage.Template.onInputChange(\\'' + __binderId("+n.obj+",'"+n.val+"') + '\\', this)'+\n'",r}).replace(a.escape||e,function(e,t){return"'+\n_.escape("+s(t)+")+\n'"}).replace(a.interpolate||e,function(e,t){return"'+\n("+s(t)+")+\n'"}).replace(a.evaluate||e,function(e,t){return"';\n"+s(t)+"\n;__p+='"})+"';\n";a.variable||(f="with(obj||{}){\n"+f+"}\n"),f="var __p='';var print=function(){__p+=Array.prototype.join.call(arguments, '')};\nvar __binderId=function(binder, attr){ return binder.id + '-' + attr.replace(/()s*$/, ''); };var __className=function(binder, attr){ return 'data-bind-'+__binderId(binder,attr); };var __bind=function(binder, attr, isFunc){ var c=__className(binder,attr); if(!Leverage.Template.allBindings[c]){ binder.bind('change:'+attr, function(newVal){var h = $('.'+c); if(isFunc){ h.text(binder[attr]()); }else{ h.text(newVal); } }); Leverage.Template.allBindings[c]=true; } return''; };\nvar __boundModel=function(m){ if(!Leverage.Template.boundModels[m.id]) Leverage.Template.boundModels[m.id] = m; return ''; };"+f+"return __p;\n";var l=new Function(a.variable||"obj","_",f);if(i)return l(i,_);var c=function(e){return l.call(this,e,_)};return c.source="function("+(a.variable||"obj")+"){\n"+f+"}",c};u.settings={interpolate:/\{=(.+?)=\}/g,escape:/\{==(.+?)==\}/g,evaluate:/\{%(.+?)%\}/g,bind:/\{=>(.+?)<=\}/g,modelBind:/\{<=(.+?)=>\}/g,twoWayBind:/\{<=>(.+?)<=>\}/g},u.onInputChange=function(e,t){var n=e.split("-"),r=n[0],i=n[1],s=u.boundModels[r],o=$(t).val();s&&s.set(i,o)},u.allBindings={},u.boundModels={},this.Leverage.Template=u}.call(this);